<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlixHub Player</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ff2d92;
            --secondary: #ff6b35;
            --accent: #7c3aed;
            --dark: #0f0f0f;
            --darker: #050505;
            --light: #ffffff;
            --gray: #1a1a1a;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--darker);
            color: var(--light);
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        /* Dev Tools Protection */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .player-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: var(--darker);
            display: flex;
            flex-direction: column;
        }

        .player-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 2rem;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: opacity 0.3s ease;
        }

        .player-header.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .movie-title {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
            flex: 1;
            margin: 0 2rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .fullscreen-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 0.5rem;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .video-wrapper {
            flex: 1;
            position: relative;
            width: 100%;
            height: 100%;
            background: black;
        }

        .video-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: black;
        }

        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--darker);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 45, 146, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }

        .error-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--darker);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            text-align: center;
            padding: 2rem;
        }

        .error-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 2rem;
        }

        .error-title {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
        }

        .error-message {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2rem;
            max-width: 500px;
        }

        .retry-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 1rem;
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 45, 146, 0.3);
        }

        .home-btn {
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Controls Auto-hide */
        .player-container.hide-controls .player-header {
            opacity: 0;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .player-header {
                padding: 0.5rem 1rem;
            }
            
            .movie-title {
                font-size: 1rem;
                margin: 0 1rem;
            }
            
            .back-btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="player-container" id="playerContainer">
        <div class="player-header" id="playerHeader">
            <a href="index.html" class="back-btn">
                <span>←</span>
                <span>Back to FlixHub</span>
            </a>
            <div class="movie-title" id="movieTitle">Loading...</div>
            <button class="fullscreen-btn" id="fullscreenBtn" title="Fullscreen">
                <span>⛶</span>
            </button>
        </div>

        <div class="video-wrapper" id="videoWrapper">
            <div class="loading-screen" id="loadingScreen">
                <div class="loading-spinner"></div>
                <div class="loading-text">
                    <div>Preparing your movie...</div>
                    <div style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.6;">This may take a few moments</div>
                </div>
            </div>

            <div class="error-screen" id="errorScreen">
                <div class="error-icon">⚠️</div>
                <div class="error-title">Unable to Load Movie</div>
                <div class="error-message" id="errorMessage">
                    We're having trouble loading this movie. Please check your internet connection and try again.
                </div>
                <div>
                    <button class="retry-btn" onclick="location.reload()">Try Again</button>
                    <a href="index.html" class="home-btn">Back to Home</a>
                </div>
            </div>

            <iframe class="video-iframe" id="videoIframe" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        // Dev Tools Protection
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || 
                (e.ctrlKey && e.shiftKey && e.key === 'C') || (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                return false;
            }
        });

        // Detect DevTools
        setInterval(() => {
            if (window.outerHeight - window.innerHeight > 200 || window.outerWidth - window.innerWidth > 200) {
                document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;font-size:2rem;color:#ff2d92;">Access Denied</div>';
            }
        }, 500);

        class MoviePlayer {
            constructor() {
                this.movieData = null;
                this.controlsTimeout = null;
                this.isControlsVisible = true;
                this.init();
            }

            init() {
                this.setupElements();
                this.parseUrlData();
                this.setupEventListeners();
                this.setupControlsAutoHide();
            }

            setupElements() {
                this.playerContainer = document.getElementById('playerContainer');
                this.playerHeader = document.getElementById('playerHeader');
                this.movieTitle = document.getElementById('movieTitle');
                this.videoIframe = document.getElementById('videoIframe');
                this.loadingScreen = document.getElementById('loadingScreen');
                this.errorScreen = document.getElementById('errorScreen');
                this.errorMessage = document.getElementById('errorMessage');
                this.fullscreenBtn = document.getElementById('fullscreenBtn');
            }

            parseUrlData() {
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const encodedData = urlParams.get('data');
                    
                    if (!encodedData) {
                        throw new Error('No movie data provided');
                    }
                    
                    // Decode the movie data
                    const decodedData = atob(decodeURIComponent(encodedData));
                    this.movieData = JSON.parse(decodedData);
                    
                    // Validate required fields
                    if (!this.movieData.id || !this.movieData.title || !this.movieData.embed_url) {
                        throw new Error('Invalid movie data structure');
                    }
                    
                    this.loadMovie();
                    
                } catch (error) {
                    console.error('Error parsing movie data:', error);
                    this.showError('Invalid movie data. Please return to the main page and try again.');
                }
            }

            loadMovie() {
                try {
                    // Update title
                    this.movieTitle.textContent = this.movieData.title;
                    document.title = `${this.movieData.title} - FlixHub Player`;
                    
                    // Set up iframe
                    this.videoIframe.src = this.movieData.embed_url;
                    
                    // Handle iframe load events
                    this.videoIframe.onload = () => {
                        this.hideLoading();
                    };
                    
                    this.videoIframe.onerror = () => {
                        this.showError('Failed to load the movie player. The content may be temporarily unavailable.');
                    };
                    
                    // Fallback timeout
                    setTimeout(() => {
                        if (this.loadingScreen.style.display !== 'none') {
                            this.hideLoading();
                        }
                    }, 8000);
                    
                } catch (error) {
                    console.error('Error loading movie:', error);
                    this.showError('An error occurred while loading the movie.');
                }
            }

            setupEventListeners() {
                // Fullscreen button
                this.fullscreenBtn.addEventListener('click', () => {
                    this.toggleFullscreen();
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case 'Escape':
                            if (document.fullscreenElement) {
                                document.exitFullscreen();
                            }
                            break;
                        case 'f':
                        case 'F':
                            this.toggleFullscreen();
                            break;
                        case ' ':
                            e.preventDefault();
                            this.showControls();
                            break;
                    }
                });

                // Fullscreen change events
                document.addEventListener('fullscreenchange', () => {
                    this.updateFullscreenButton();
                });
            }

            setupControlsAutoHide() {
                // Show controls on mouse move
                this.playerContainer.addEventListener('mousemove', () => {
                    this.showControls();
                });

                // Hide controls when mouse leaves
                this.playerContainer.addEventListener('mouseleave', () => {
                    this.hideControls();
                });

                // Touch events for mobile
                this.playerContainer.addEventListener('touchstart', () => {
                    this.toggleControls();
                });
            }

            showControls() {
                this.isControlsVisible = true;
                this.playerContainer.classList.remove('hide-controls');
                
                // Clear existing timeout
                if (this.controlsTimeout) {
                    clearTimeout(this.controlsTimeout);
                }
                
                // Set new timeout to hide controls
                this.controlsTimeout = setTimeout(() => {
                    this.hideControls();
                }, 3000);
            }

            hideControls() {
                this.isControlsVisible = false;
                this.playerContainer.classList.add('hide-controls');
                
                if (this.controlsTimeout) {
                    clearTimeout(this.controlsTimeout);
                }
            }

            toggleControls() {
                if (this.isControlsVisible) {
                    this.hideControls();
                } else {
                    this.showControls();
                }
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    this.playerContainer.requestFullscreen().catch(err => {
                        console.error('Error entering fullscreen:', err);
                    });
                } else {
                    document.exitFullscreen().catch(err => {
                        console.error('Error exiting fullscreen:', err);
                    });
                }
            }

            updateFullscreenButton() {
                const isFullscreen = !!document.fullscreenElement;
                this.fullscreenBtn.innerHTML = isFullscreen ? '<span>⛶</span>' : '<span>⛶</span>';
                this.fullscreenBtn.title = isFullscreen ? 'Exit Fullscreen' : 'Enter Fullscreen';
            }

            hideLoading() {
                this.loadingScreen.style.display = 'none';
            }

            showError(message) {
                this.loadingScreen.style.display = 'none';
                this.errorMessage.textContent = message;
                this.errorScreen.style.display = 'flex';
            }
        }

        // Initialize player when page loads
        const moviePlayer = new MoviePlayer();

        // Prevent iframe from being manipulated
        window.addEventListener('message', (event) => {
            // Only allow messages from trusted domains
            const trustedDomains = ['vidsrc.cc', 'vidsrc.to', 'vidsrc.me'];
            const isAllowed = trustedDomains.some(domain => event.origin.includes(domain));
            
            if (!isAllowed) {
                console.warn('Blocked message from untrusted origin:', event.origin);
                return;
            }
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is hidden, pause any animations
                document.querySelectorAll('.loading-spinner').forEach(spinner => {
                    spinner.style.animationPlayState = 'paused';
                });
            } else {
                // Page is visible, resume animations
                document.querySelectorAll('.loading-spinner').forEach(spinner => {
                    spinner.style.animationPlayState = 'running';
                });
            }
        });
    </script>
</body>
</html>
